<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <title>Document</title>
</head>
<body>
    <svg width="1000" height="920" id="mainsvg" class="svgs"></svg>

    <script>
        const svg = d3.select('#mainsvg');
        const width = +svg.attr('width');
        const height = +svg.attr('height');
        const g = svg.append('g').attr('id', 'maingroup')
        // .attr('transform', `translate(${margin.left}, ${margin.top})`); 
        let root;

        const render=()=>{
            const color = d3.scaleOrdinal(d3.schemeCategory10)
            const fill=d=>{
                if (!d.depth) return "#666666";
                while (d.depth > 1) 
                    d = d.parent; 
                return color(d.data.name); 
            }
            g.selectAll('.datarect').data(root.descendants()).join('rect')
            .attr('class','datarect')
            .attr('x', d => d.y0)
            .attr('y', d => d.x0)
            .attr('height', d => d.x1 - d.x0)
            .attr('width', d => d.y1 - d.y0)
            .attr("fill", fill);

            g.selectAll('.datatext')
            .data(root.descendants().filter( d => (d.x1 - d.x0) > 20 ))
            .join('text')
            .attr('class', 'datatext')
            .attr('text-anchor', 'middle')
            .attr('x', d => (d.y0 + d.y1)/2)
            .attr('y', d => (d.x0 + d.x1)/2)
            .attr('dy', '0.35em')
            .attr('font-size', '1em')
            .text(d => d.data.name)
        }

        d3.json('../static/data/games.json').then(data=>{
            root = d3.partition().size([height, width])
            (d3.hierarchy(data).sum(d => d.popularity).sort((a, b) => b.popularity - a.popularity));
            console.log(root);
            render()
        })
    </script>
</body>
</html>